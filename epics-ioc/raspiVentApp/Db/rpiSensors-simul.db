#
# Project       : air4all-portugal  Control
#
# File          :
# Description   : Records for Vnetilator Control
#
##
# Author        : Bernardo Carvalho (IPFN-IST)
#
# Copyright (c) : Air4All
# Created 19-Mar-2020
#
##
# Fanout Proc records
record(fanout, "$(P)$(R)TIME-FNOUT"){
    field(LNK1, "$(P)$(R)Sensor-Pressure")
    field(LNK2, "$(P)$(R)Sensor-Flow")
#    field(LNK3, "$(P)$(R)TMPump1-Acceleration")
#    field(LNK4, "$(P)$(R)TMPump1-NormalOperation")
}
record(calc,"$(P)$(R)Sensor-Pressure"){
    field(DESC,"Input Air pressure ")
    field(PREC,"3")
    field(INPA, "$(P)$(R)TIME-COUNTER")
    field(INPB, "$(P)$(R)PEEP")
    field(CALC, "(A<=0.5)? -A : ((A<3.0)? 0 : B)")
    field(EGU,"cmH2O")
    field(HOPR,"30")
    field(LOPR,"0")
    field(HIHI,"30")
    field(HIGH,"25")
    field(LOW,"2")
    field(LOLO,"1")
}

record(calc,"$(P)$(R)Sensor-Flow"){
    field(DESC,"Simulated Inspired/Expired Mix Flow ")
    field(PREC,"1")
    field(INPA, "$(P)$(R)TIME-COUNTER")
    field(CALC, "(A<=0.5)? 0 : ((A<1.5)? 40 : (A<2.5)? -40: 0) ")
    field(EGU,"l/m")
    field(HOPR,"200")
    field(LOPR,"-200")
    field(HIHI,"200")
    field(HIGH,"150")
    field(LOW,"-150")
    field(LOLO,"-200")
    field(FLNK, "$(P)$(R)Volume-InspExp" )
}

record(calc,"$(P)$(R)Volume-InspExp"){
    field(DESC, "Calculated Insp/Exp Volume")
    field(INPA, "$(P)$(R)TIME-COUNTER")
    field(INPB, "$(P)$(R)Volume-InspExp NPP")
    field(INPC, "$(P)$(R)Sensor-Flow NPP")
#  One minute has 1200 * 0.05 steps 
    field(CALC, "(A==0)? 0 : B + C/1200.0*1000.0")
    field(PREC,"1")
    field(EGU,"ml")
    field(VAL,"0")
}
