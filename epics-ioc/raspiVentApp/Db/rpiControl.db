#
# Project       : air4all-portugal  Control
#
# File          :
# Description   : Records for Vnetilator Control
#
##
# Author        : Bernardo Carvalho (IPFN-IST)
#
# Copyright (c) : Air4All
# Created 19-Mar-2020
#
##


### include record bi with inspiration and expiration states. -> LED
record(bo, "$(P)$(R)Flow-Direction" ) {
   field(DESC,"Inspiration/Experiation Mode")
#
#	field( OUT,  "$(P)$(R)PCF8574:57:REGISTER.B2 PP MS")
	field( ZNAM, "Inspiration")
	field( ONAM, "ExppirationF")
}

record(mbbo, "$(P)$(R)OPMODE") {
    field(DESC, "Ventilation Operator Mode")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(TWVL, "2")
    field(THVL, "3")
    field(FRVL, "4")
    field(FVVL, "5")
    field(SXVL, "6")
    field(ZRST, "Stopped")
    field(ONST, "Idle")
    field(TWST, "AC Volume Control")
    field(THST, "AC Pressure Control")
    field(FRST, "Pressure Support")
    field(FVST, "Alarm Setting")
    field(SXST, "Emergency")
    field(VAL, "0")
}
record(calc, "$(P)$(R)TIME-COUNTER") {
    field(DESC, "0.1 s counter")
    field(INPA, "$(P)$(R)TIME-COUNTER")
    field(INPB, "$(P)$(R)RR-MAXTIME NPP MS")
#    field(SCAN, ".1 second")
    field(SCAN, ".05 second")
    field(CALC, "(A>=B)? 0 : A + 0.05")
    field(VAL, "0")
#    field(FLNK, "$(P)$(R)TIME-FNOUT" )
    field(FLNK, "$(P)$(R)Sensor-Flow")
}
# Fanout Proc records
#record(fanout, "$(P)$(R)TIME-FNOUT"){
#    field(LNK1, "$(P)$(R)Sensor-Flow")
#    field(LNK2, "$(P)$(R)Sensor-Pressure")
#    field(LNK3, "$(P)$(R)Sensor-Volume")
#    field(LNK3, "$(P)$(R)TMPump1-Acceleration")
#    field(LNK4, "$(P)$(R)TMPump1-NormalOperation")
#}
record(stringin, "$(P)$(R)CurrentTime") {
    field(DESC, "Current Date and Time of the IOC")
    field(SCAN, "1 second")
    field(DTYP, "Soft Timestamp")
    field(PINI, "YES")
    field(INP, "@%d/%m/%Y %H:%M:%S")
}
record(stringout, "$(P)$(R)TraceMessage") {
    field(DESC, "Trace Message from IOC")
    field(VAL, "Trace mode ON")
}
record(stringout, "$(P)$(R)LogMessage") {
    field(DESC, "Log Message ")
}
record(ai,"$(P)$(R)Sensor-Ppeak"){
    field(DESC,"Maximum pressure reached in each cycle")
    field(PREC,"1")
    field(EGU,"cmH2O")
    field(VAL,"40")
    field(HOPR,"150")
    field(LOPR,"0")
    field(HIGH,"80")
    field(LOW,"0")
}
record(ai,"$(P)$(R)Sensor-PEEP"){
    field(DESC,"Current measured PEEP")
    field(PREC,"1")
    field(EGU,"cmH2O")
    field(VAL,"5")
    field(HOPR,"50")
    field(LOPR,"0")
    field(HIGH,"50")
    field(LOW,"0")
}
record(ao,"$(P)$(R)Set-Vt"){
    field(DESC,"Tidal Volume Setting")
    field(PREC,"0")
    field(EGU,"ml")
    field(VAL,"400.0")
# Drive High /Low
    field(DRVH,"1400")
    field(DRVL,"200")
    field(HOPR,"1400")
    field(LOPR,"200")
    field(HIGH,"800")
    field(LOW,"100")
}
record(longout,"$(P)$(R)Set-FiO2"){
    field(DESC,"O2 Concentration Setting")
    field(EGU,"%")
    field(VAL,"50")
# Drive High /Low
    field(DRVH,"100")
    field(DRVL,"20")
    field(HOPR,"100")
    field(LOPR,"20")
}
record(ao,"$(P)$(R)Set-FiO2-Margin"){
    field(DESC,"O2 Concentration Margin Setting")
    field(EGU,"%")
    field(VAL,"5")
# Drive High /Low
    field(DRVH,"20")
    field(DRVL,"0")
    field(HOPR,"20")
    field(LOPR,"0")
}
record(ao,"$(P)$(R)Set-PEEP"){
    field(DESC,"Positive End Expiratory Pressure Setting")
    field(PREC,"0")
    field(EGU,"cmH2O")
    field(VAL,"5.0")
# Drive High /Low
    field(DRVH,"20")
    field(DRVL,"0")
    field(HOPR,"20")
    field(LOPR,"0")
}
record(ao,"$(P)$(R)Set-Ppeak"){
    field(DESC,"Peak Preassure PC/PS Setting")
    field(PREC,"0")
    field(EGU,"cmH20")
    field(VAL,"40")
# Drive High /Low
    field(DRVH,"100")
    field(DRVL,"0")
    field(HOPR,"100")
    field(LOPR,"0")
    field(HIGH,"80")
    field(LOW,"0")
}
record(ao,"$(P)$(R)Set-Ptrigger"){
    field(DESC,"Trigger Preassure PS Setting")
    field(PREC,"0")
    field(EGU,"cmH20")
    field(VAL,"-2")
# Drive High /Low
    field(DRVH,"0")
    field(DRVL,"-20")
    field(HOPR,"0")
    field(LOPR,"-20")
}
record(ao,"$(P)$(R)Set-Tinsp"){
    field(DESC,"Inspiration Time Setting")
    field(PREC,"1")
    field(EGU,"s")
    field(VAL,"1.3")
# Drive High /Low
    field(DRVH,"10")
    field(DRVL,"0.1")
    field(HOPR,"10")
    field(LOPR,"0.1")
    field(HIGH,"8")
    field(LOW,"0.2")
}
record(ao,"$(P)$(R)Set-TinspRise") {
    field(DESC,"Time to rise to maximum P")
    field(PREC,"1")
    field(EGU,"s")
    field(VAL,"0.5")
# Drive High /Low
    field(DRVH,"10")
    field(DRVL,"0.1")
    field(HOPR,"10")
    field(LOPR,"0.1")
    field(HIGH,"8")
    field(LOW,"0.2")
}
record(ao,"$(P)$(R)Set-RespRate"){
    field(DESC,"Respiration Rate Setting")
    field(EGU,"b/min")
    field(VAL,"12")
    field(HOPR,"20")
    field(LOPR,"2")
    field(HIHI,"18")
    field(HIGH,"7")
    field(LOW,"4")
    field(LOLO,"2")
    field(PINI,"YES")
    field(FLNK, "$(P)$(R)RR-MAXTIME" )
}
record(ao,"$(P)$(R)Set-RespRateMargin"){
    field(DESC,"Respiration Rate Margin Setting")
    field(EGU,"b/min")
    field(VAL,"5")
    field(DRVH,"10")
    field(DRVL,"0")
    field(HOPR,"10")
    field(LOPR,"0")
}
record(calc, "$(P)$(R)RR-MAXTIME") {
    field(DESC, "Max RR Time")
    field(INPA, "$(P)$(R)Set-RespRate NPP")
    field(CALC, "60.0 / A")
    field(EGU,"Sec")
    field(VAL, "10.0")
}
# record(ao,"$(P)$(R)Tidal-Volume-Expiration"){
#     field(DESC,"Tidal Volume Expiration Setting")
#     field(PREC,"0")
#     field(EGU,"ml")
#     field(VAL,"400.0")
# # Drive High /Low
#     field(DRVH,"1400")
#     field(DRVL,"200")
#     field(HOPR,"1400")
#     field(LOPR,"200")
#     field(HIGH,"800")
#     field(LOW,"100")
# }
