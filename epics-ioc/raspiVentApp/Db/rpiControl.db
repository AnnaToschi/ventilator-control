#
# Project       : air4all-portugal  Control
#
# File          :
# Description   : Records for Vnetilator Control
#
##
# Author        : Bernardo Carvalho (IPFN-IST)
#
# Copyright (c) : Air4All
# Created 19-Mar-2020
#
##
record(mbbi, "$(P)$(R)OPMODE") {
    field(DESC, "Ventilation Opertator Mode")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(TWVL, "2")
    field(THVL, "3")
    field(FRVL, "4")
    field(FVVL, "5")
    field(SXVL, "6")
    field(ZRST, "Stopped")
    field(ONST, "Idle")
    field(TWST, "AC Volume Control")
    field(THST, "AC Pressure Control")
    field(FRST, "WaitShot")
    field(FVST, "Stopping")
    field(SXST, "Emergency")
    field(VAL, "0")
}

record(calc, "$(P)$(R)TIME-COUNTER") {
    field(DESC, "0.1 s counter")
    field(INPA, "$(P)$(R)TIME-COUNTER")
    field(INPB, "$(P)$(R)RR-MAXTIME NPP MS")
#    field(SCAN, ".1 second")
    field(SCAN, ".05 second")
    field(CALC, "(A>=B)? 0 : A + 0.05")
    field(VAL, "0")
    field(FLNK, "$(P)$(R)TIME-FNOUT" )
}

record(stringin, "$(P)$(R)CurrentTime") {
    field(DESC, "Current Date and Time of the IOC")
    field(SCAN, "1 second")
    field(DTYP, "Soft Timestamp")
    field(PINI, "YES")
    field(INP, "@%d/%m/%Y %H:%M:%S")
}

record(stringout, "$(P)$(R)TraceMessage") {
    field(DESC, "Trace Message from IOC")
    field(VAL, "Trace mode ON")
}

record(stringout, "$(P)$(R)LogMessage") {
    field(DESC, "Log Message ")
}

record(ao,"$(P)$(R)Tidal-Volume"){
    field(DESC,"Tidal Volume Setting")
    field(PREC,"0")
    field(EGU,"ml")
    field(VAL,"400.0")
# Drive High /Low
    field(DRVH,"1400")
    field(DRVL,"200")
    field(HOPR,"1400")
    field(LOPR,"200")
    field(HIGH,"800")
    field(LOW,"100")
}
record(ao,"$(P)$(R)Tidal-Volume-Expiration"){
    field(DESC,"Tidal Volume Expiration Setting")
    field(PREC,"0")
    field(EGU,"ml")
    field(VAL,"400.0")
# Drive High /Low
    field(DRVH,"1400")
    field(DRVL,"200")
    field(HOPR,"1400")
    field(LOPR,"200")
    field(HIGH,"800")
    field(LOW,"100")
}
record(ao,"$(P)$(R)Flow"){
    field(DESC,"Flow Setting")
    field(PREC,"1")
    field(EGU,"l/m")
    field(HOPR,"150")
    field(LOPR,"40")
    field(DRVH,"150")
    field(DRVL,"40")
    field(HIGH,"120")
    field(LOW,"60")
}
record(longout,"$(P)$(R)FiO2"){
    field(DESC,"O2 Concentration Setting")
    field(EGU,"%")
    field(VAL,"50")
# Drive High /Low
    field(DRVH,"100")
    field(DRVL,"20")
    field(HOPR,"100")
    field(LOPR,"20")
}
record(ao,"$(P)$(R)PEEP"){
    field(DESC,"Positive End Expiratory Pressure Setting")
    field(PREC,"0")
    field(EGU,"cmH2O")
    field(VAL,"5.0")
# Drive High /Low
    field(DRVH,"20")
    field(DRVL,"2")
    field(HOPR,"20")
    field(LOPR,"2")
}
record(ao,"$(P)$(R)Ppeak"){
    field(DESC,"Peak Preassure PC/PS Setting")
    field(PREC,"0")
    field(EGU,"cmH20")
    field(VAL,"40")
# Drive High /Low
    field(DRVH,"100")
    field(DRVL,"0'")
    field(HOPR,"100")
    field(LOPR,"0")
    field(HIGH,"80")
    field(LOW,"2")
}
record(ao,"$(P)$(R)Ptrigger"){
    field(DESC,"Trigger Preassure PS Setting")
    field(PREC,"0")
    field(EGU,"cmH20")
    field(VAL,"-2")
# Drive High /Low
    field(DRVH,"0")
    field(DRVL,"-20'")
    field(HOPR,"0")
    field(LOPR,"-20")
}
record(ao,"$(P)$(R)Tinsp"){
    field(DESC,"Inspiration Time Setting")
    field(PREC,"1")
    field(EGU,"s")
    field(VAL,"1.3")
# Drive High /Low
    field(DRVH,"2")
    field(DRVL,"0.5'")
    field(HOPR,"2")
    field(LOPR,"0.5")
    field(HIGH,"2.5")
    field(LOW,"0.3")
}
record(longout,"$(P)$(R)Resp-Rate"){
    field(DESC,"Respiration Rate Setting")
    field(EGU,"b/min")
    field(VAL,"12")
    field(HOPR,"20")
    field(LOPR,"2")
    field(HIHI,"18")
    field(HIGH,"7")
    field(LOW,"4")
    field(LOLO,"2")
    field(PINI,"YES")
    field(FLNK, "$(P)$(R)RR-MAXTIME" )
}

record(calc, "$(P)$(R)RR-MAXTIME") {
    field(DESC, "Max RR Time")
    field(INPA, "$(P)$(R)Resp-Rate NPP")
    field(CALC, "60.0 / A")
    field(EGU,"Sec")
    field(VAL, "10.0")
}
